# EctoSharding

Simple Database Sharding in Ecto.

Ecto Repository distributed multiple databases by modulo.
Modulo target is user_id, generated by sequencer database.

### Support database
- MySQL

## Installation

If [available in Hex](https://hex.pm/docs/publish), the package can be installed
by adding `ecto_sharding` to your list of dependencies in `mix.exs`:

```elixir
def deps do
  [
    {:ecto_sharding, "~> 0.1.0"}
  ]
end
```

### Usage
Add database connections to you application's config/#{env}.exs:

```elixir
user_databases = [
  [
    adapter: Ecto.Adapters.MySQL,
    username: "mysql_user",
    password: "password",
    database: "user_0",
    hostname: "localhost",
    pool_size: 5
  ],
  [
    adapter: Ecto.Adapters.MySQL,
    username: "mysql_user",
    password: "password",
    database: "user_1",
    hostname: "localhost",
    pool_size: 5
  ]
]

user_sequencer = [
  adapter: Ecto.Adapters.MySQL,
  username: "mysql_user",
  password: "password",
  database: "user_0",
  hostname: "localhost",
  pool_size: 5
]

config :ecto_sharding, :config, [
  app_name: :your_app_name,
  base_module_name: YourAppName.ShardedRepositories
]

config :sharding_app, :cluster, [
  databases: user_databases,
  count: Enum.count(user_databases),
  name: "Users",
  table: "users",
  worker_name: YourAppName.Repositories.Users,
  supervisor_name: YourAppName.Repositories.UserSupervisor,
]

config :sharding_app, :sequencer, [
  sequencer: user_sequencer,
  table: "user_id",
  worker_name: YourAppName.Repositories.Sequencer,
  supervisor_name: YourAppName.Repositories.SequenceSupervisor
]

config :sharding_app, ecto_repos: []
```

Add this example your application's lib/your_app_name/shards/users.ex:

```elixir
defmodule YourAppName.Shards.Users do
  use Ecto.Sharding.Shards.ShardingInitializer
  use Ecto.Sharding.Shards.SequencerInitializer
end
```
